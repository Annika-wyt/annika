<?xml version="1.0"?>
<launch>
    <!-- Launch file arguments -->
    <arg name="camera_image_topic"      default="/camera/image_raw"/>
    <arg name="camera_info_topic"       default="/camera/camera_info"/>
    <arg name="aruco_dict"              default="DICT_4X4_250"/>
    <arg name="aruco_size"              default="0.1"/>
    <arg name="aruco_tf_name"           default="arucoCamera"/>

    <!-- Nodes -->
    <node if="$(eval map != '')" pkg="map_server" type="map_server" name="map_server" output="screen" args="/svea_ws/src/svea_core/maps/sml.yaml"/>

    <node pkg="tf2_ros" type="static_transform_publisher" name="odommap_broadcaster"    args="0 0 0 0 0 0 map odom" />   
    <node pkg="tf2_ros" type="static_transform_publisher" name="linkodom_broadcaster"    args="0 0 0 0 0 0 odom base_link" />   
    <node pkg="tf2_ros" type="static_transform_publisher" name="imulink_broadcaster"    args="0 0 0.1 0 0 0 base_link imu" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="gpslink_broadcaster"    args="-0.058 -0.015  0.115 0 0 0 base_link gps" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="maparuco_broadcaster"  args="0 0 0 0 0 0 map aruco0" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="cameralink_broadcaster"    args="0.3975 0.0 0.237 -1.57 0 -1.57 base_link camera" />
    <!-- z = 0.2152 by mocap -->
      <!-- for e-com-4k -->

    <node pkg="rosserial_python" type="serial_node.py" name="serial_node">
        <param name="port" value="/dev/ttyACM0"/>
        <param name="baud" value="250000"/>
    </node>

    <!-- Robot localization (initial estimation EKF)-->
    <node pkg="robot_localization" type="ekf_localization_node" name="ekf_estimation" clear_params="true" output="screen">
        <rosparam command="load" file="$(find svea_sensors)/params/robot_localization/estimation_ekf.yaml" />
        <rosparam subst_value="true">
        initial_state: [0.0, 0.0, 0.0, 
                        0.0, 0.0, 0.0, 
                        0.0, 0.0, 0.0, 
                        0.0, 0.0, 0.0, 
                        0.0, 0.0, 0.0]
        </rosparam>
        <param name="publish_tf"            value="false"/>
        <param name="odom0"                 value="rs/t265_camera/odom/sample"/>
        <param name="imu0"                  value="imu/data"/>
        <param name="twist0"                value="actuation_twist"/>
        <param name="twist1"                value="wheel_encoder_twist"/>
        <remap from="/odometry/filtered"    to="/ekf_estimation/odometry/filtered/"/>
    </node>

    <node name="aruco_detect" pkg="svea_sensors" type="aruco_detect.py" output="screen">
        <param name="sub_image"         value="$(arg camera_image_topic)"/>
        <param name="camera_info"       value="$(arg camera_info_topic)"/>
        <param name="aruco_dict"        value="$(arg aruco_dict)"/>
        <param name="aruco_size"        value="$(arg aruco_size)"/>
        <param name="aruco_tf_name"     value="$(arg aruco_tf_name)"/>
    </node>

    <!-- <node name="aruco_pose" pkg="svea_sensors" type="aruco_pose.py" output="screen"/> -->
    <node name="p3p_process_data" pkg="svea_sensors" type="p3p_process_data.py" output="screen"/>

</launch>